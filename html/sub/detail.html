<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title></title>
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<link href="../../css/mui.min.css" rel="stylesheet" />
<link href="../../css/list-to-detail.css" rel="stylesheet" />
</head>

<body>

<div class="mui-content">
	<!--顶部banner图 开始-->
	<div id="kr-article-banner" class="kr-article-banner">
		<div id="kr-article-cover" class="kr-article-cover">
			<img :src="cover">
		</div>
		<h2 id="kr-article-title" class="kr-article-title">{{title}}</h2>
	</div>
	<!--顶部banner图 结束-->
	
	<div class="kr-article-content">
		<!-- 文章作者、发布时间等信息 -->
		<div class="kr-article-meta">
			<div id="kr-article-author" class="kr-article-author">{{author}}</div>
			<div class="kr-article-text">发表于</div>
			<div id="kr-article-time" class="kr-article-time">{{time}}</div>
			
		</div>
		
		<div>
			<div class="button" onclick="startPlay('_www/audio/friendship.mp3');">播放音乐</div>
		</div>
		<!--文章详细内容-->
		<div id="kr-article-article" class="kr-article-article" v-html="content"></div>
	</div>
</div>


<div id="play" class="rp">
	<div id="ptime" class="ptime">00:00:00/00:00:00</div><br/>
	<div id="progress" class="progress"><div id="schedule" class="schedule"></div></div>
	<br/>
	<div class="stop" onclick="stopPlay();"></div>
</div>

<script src="../../js/mui.min.js"></script>
<script src="../../js/vue.min.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
	mui.init();

	// 扩展API加载完毕后调用onPlusReady回调函数 
	document.addEventListener( "plusready", onPlusReady, false );
	// 扩展API加载完毕，现在可以正常调用扩展API 
	
	function onPlusReady() {
		
	}
	
	function getDefaultData() {
		return {
			cover: '',
			title: '',
			author: '',
			time: '',
			content: ''
		}
	}

	var vm = new Vue({
		el: '.mui-content',
		data: getDefaultData(),
		methods: {
			resetData: function() {//重置数据
				Object.assign(this.$data, getDefaultData());
			}
		}
	});

	//监听自定义事件，获取新闻详情
	document.addEventListener('get_detail', function(event) {
		var guid = event.detail.guid;
		if(!guid) {
			return;
		}
		//前页传入的数据，直接渲染，无需等待ajax请求详情后
		vm.cover = event.detail.cover;
		vm.title = event.detail.title;
		vm.author = event.detail.author;
		vm.time = event.detail.time;
		//向服务端请求文章详情内容
		mui.ajax('http://spider.dcloud.net.cn/api/news/36kr/' + guid, {
			type:'GET',
			dataType: 'json', //服务器返回json格式数据
			timeout: 15000, //15秒超时
			success: function(rsp) {
				vm.content = rsp.content;
			},
			error: function(xhr, type, errorThrown) {
				mui.toast('获取文章内容失败');
				//TODO 此处可以向服务端告警
			}
		});
	});

	//重写返回逻辑
	mui.back = function() {
		plus.webview.currentWebview().hide("auto", 300);
		//动画结束后，恢复默认值
		setTimeout(function() {
			window.scrollTo(0, 0);
			vm.resetData();
		}, 300);
	};
	
	document.addEventListener("swiperight",function(){
	    mui.back();
	    stopPlay();
	});
</script>










<script type="text/javascript" src="../../js/common.js"></script>
<script type="text/javascript">
// 播放文件相关对象
var p=null,pt=null,pp=null,ps=null,pi=null;
var ep=null;

// DOMContentLoaded事件处理
document.addEventListener('DOMContentLoaded', function(){
	// 获取DOM元素对象
	ep = document.getElementById('play');
	pt = document.getElementById('ptime');
	pp = document.getElementById('progress')
	ps = document.getElementById('schedule');
	//updateHistory();
},false);



// 开始播放
function startPlay(url){
	//ep = document.getElementById('play');
	ep.style.display = 'block';
	var L = pp.clientWidth;
	p = plus.audio.createPlayer(url);
	p.play(function(){
		//outLine('播放完成！');
		// 播放完成
		pt.innerText = timeToStr(d)+'/'+timeToStr(d);
		ps.style.webkitTransition = 'all 0.3s linear';
		ps.style.width = L+'px';
		stopPlay();
	}, function(e){
		//outLine('播放音频文件"'+url+'"失败：'+e.message);
	});
	// 获取总时长
	var d = p.getDuration();
	if(!d){
		pt.innerText = '00:00:00/'+timeToStr(d);
	}
	pi = setInterval(function(){
		if(!d){ // 兼容无法及时获取总时长的情况
			d = p.getDuration();
		}
		var c = p.getPosition();
		if(!c){  // 兼容无法及时获取当前播放位置的情况
			return;
		}
		pt.innerText = timeToStr(c)+'/'+timeToStr(d);
		var pct = Math.round(L*c/d);
		if(pct < 8){
			pct = 8;
		}
		ps.style.width = pct+'px';
	}, 1000);
}
// 停止播放
function stopPlay(){
	clearInterval(pi);
	pi=null;
	setTimeout(resetPlay, 500);
	// 操作播放对象
	if(p){
		p.stop();
		p=null;
	}
}
// 重置播放页面内容
function resetPlay(){
	ep.style.display = 'none';
	ps.style.width = '8px';
	ps.style.webkitTransition = 'all 1s linear';
	pt.innerText = '00:00:00/00:00:00';	
}
// 重写关闭
var _back=window.back;
function resetback(){
	// 停止播放
	if(ep.style.display == 'block'){
		stopPlay();
	}else{
		//_back() = mui.back();
	}
}
window.back=resetback;
</script>
<script type="text/javascript" src="../../js/immersed.js" ></script>


<link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8"/>
<style type="text/css">
.rp {
	width: 100%;
	height: 100%;
	display: none;
	text-align: center;
	position: fixed;
	top: 0;
	background: rgba(0,0,0,0.8);
	z-index: 9999;
	overflow: hidden;
}
.aname {
	font-size: 16px;
}
.ainf {
	font-size: 12px;
}
.rtime {
	font-size: 22px;
	color: #FF0000;
}
.ptime {
	margin-top: 40%;
	font-size: 22px;
	color: #FFFFFF;
}
.rprogress {
	background: url(../img/arecord.png) no-repeat center center;
	background-size: 32px 32px;
}
.rschedule {
    background-color: rgba(0,0,0,0);
    border: 5px solid rgba(0,183,229,0.9);
    opacity: .9;
    border-left: 5px solid rgba(0,0,0,0);
    border-right: 5px solid rgba(0,0,0,0);
    border-radius: 50px;
    box-shadow: 0 0 15px #2187e7;
    width: 36px;
    height: 36px;
    margin: 0 auto;
    -webkit-animation: spin 1s infinite linear;
    animation: spin 1s infinite linear;
}
@-webkit-keyframes spin {
    0% {
        -webkit-transform: rotate(0deg);
    }
    100% {
        -webkit-transform: rotate(360deg);
    }
}
@keyframes spin {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
}
.progress {
  width: 90%;
  background-color: #666;
  margin: 0 5%;
  border: 1px solid #222;
  -webkit-border-radius: 5px;
  border-radius: 5px;
}
.schedule {
  width: 8px;
  height: 8px;
  margin: 1px 0;
  background-color: #FFCC33;
  -webkit-border-radius: 4px;
  border-radius: 4px;
  -webkit-transition: all 1s linear;
  transition: all 1s linear;
}
.stop {
	width: 72px;
	height: 72px;
	background: url(../../images/astop.png) center center;
	background-size: 72px 72px;
	margin: auto;
	-webkit-border-radius: 72px;
	border-radius: 72px;
}
.stop:active{
  	-webkit-box-shadow: 0 3px 8px rgba(0, 0, 0, 0.5) inset;
	box-shadow: 0 3px 8px rgba(0, 0, 0, 0.5) inset;
}
.iplay {
	display: block;
	background: no-repeat right center url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABYCAYAAAADWlKCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAKwwAACsMBNCkkqwAAABZ0RVh0Q3JlYXRpb24gVGltZQAwOS8xMi8xM5w+I3MAAAAcdEVYdFNvZnR3YXJlAEFkb2JlIEZpcmV3b3JrcyBDUzVxteM2AAAD9UlEQVR4nO2b3XETMRRGDwzvoYOkg5hRAVkqiKmAdIA7wHSQVECoALsC1gXciV0BTge4gvCwgnHk9d/+WF8m97ztxrlXs8fS1Urym6enJxwd3uZugPMcFyKGCxHDhYjhQsRwIWK4EDFciBguRAwXIoYLEcOFiOFCxHAhYrgQMVyIGC5EDBcihgsRw4WI4ULEcCFiuBAx3uVuwDGY2XtgCBTAALjc8tEFMAdKYBJC+HOK9nXBm5dwUM7MCmAEXDcMMQVuQwhlV23qC2khZjYAboGrjkLOgFEIYd5RvM6RrSFmdgs80J0MYqyHGFsSuR4S60TJ9vrwCEziZ+YhhGXy/xdU9aWgqjfnW+IsgEKtvkgJiUPUPfUyZsD42DoQ68+Y+p62AG6UhjAZITt6xopq3L9vGf+Gqh6dJX+S6ilKNaRkU8YCGLSVARBjDGLMdS5jbgkkhMQiWyejSGtEG2KsghopKoU++5AV68ZDcrvXYWTH8Pghdz1R6CHpN3MFDPsc02PsYcy1qy0nJ6uQOANKZz+jfcOUmd3H6W1jYo5RcvsqtikbuXtI+kBmBxbwz8DczMZtksdcsz1tOinZhMRxPF2bGh8R4gz4amZLMxu2aEqa8zq2LQs5e0j6EB8bLv6dAz/NrGwyjMWcj3vadjJyCimS60nLeFfAbzO7bfANT3MXLdvSmJxCBsl12VHcL8AyvpkfSpo7bdvJyCkkfQfocv5/Bnw3s/mBs6Y097aFzd7JPcv6T5dv5GtcAr/2TZN7yt0IGSE908k0+RS8FiEvhhd1yKEFUw5YAVBApoe0XQrZwgL4GEIY7pLRU+5G5OwhC57PZgbAsqPYK6rdxUMXC9Npbro8fzJy9pB0qll0FPcOuDhCRl3ubEvwOYWUyXXb5YoZ1X7GqMHSfZq7bNmWxuQUki5XnDdc+n4EPoUQiiabSzFnejKl7TJOY7IJid/iaXJ7fESIFfCNas+9zQNMc05zHnjIPctKx/mrA9egflCJGLd5eDFXukGWdddQYU+95PlDWVE97GXPeS+oivf6saBZCKHoM+8+cvcQ2NyhOwMmfW4SxdgTNs9oZd0tBAEhsRDfJbcvgbIPKTtOnNzlPnECAkPWP8xsTv3ZrJ1v2UfmuKDqGRt5QgjZ9kDWyd5D1iioP1U4P3KzqZYYY5v0om38rpDpIeCHrUFMCPjPEeSE/COetf3SU/i7EEL2GVUdSjXkGfGBfWDzIFsb/q93dRizU2R7yDr+o09R/GfRzsmRrSGvFRcihgsRw4WI4ULEcCFiuBAxXIgYLkQMFyKGCxHDhYjhQsRwIWK4EDFciBguRAwXIoYLEcOFiOFCxHAhYrgQMf4CVuqCm+17t3sAAAAASUVORK5CYII=);
	background-size: 50px 44px;
	-ms-touch-action: auto;
}
</style>

</body>

</html>